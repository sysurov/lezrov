# 机器鱼原理图及PCB Layout  
### 分文件说明：  
- 单关节机器鱼通信架构v1.0.pdf  
机器鱼的通讯架构，实际上也是机器鱼的硬件模块组织。
可以看到在机器鱼内部是使用UART环路进行数据发送的（源码中所写的波特率是115200），环路的起点是Wrtnode的Tx脚，每一节点需要实现一个状态机（可参考官方源码，具有一定的可移植性），判断包内信息的Id是否是自己的Id，如果是的话就处理并发送处理结果到下一个节点，不是的话就直接把上一个节点发来的数据包向下传递。
通讯协议:
```
| 包头 | 类型 | 长度 |   Id  | 命令  | 参数  | 校验  | 包尾 |
| 0x21 | 1位  | 7位  | 1字节 | 1字节 | n字节 | 1字节 | 0x52 |
类型： 1.写命令 0.读数据
长度： Id+命令+参数 的长度，单位为字节
校验： Id+命令+参数 的校验和
```

- Wrtnode.pdf :  
“视觉仓”与wifi部分。内部有摄像头模块和Wrtnode模块（型号不明，可能需要拆解，看是否是第三方产品），它们之间通过USB通讯。Wrtnode负责进行wifi收发，并将接收到的内容通过UART交给板载STM32，STM32通过另一个UART界面向后续模块发送信息。（源码里有用的只有UART.c，这么点功能还用了一块STM32F101C8T6，真鸡儿浪费）
该组件内有UHT11湿度传感器

- STM32Core.pdf :  
不知道是干啥的，通讯架构里没有这一部分，源码里也没有  

- Sensor.pdf :  
配备了GY271，MP180和MPU6050的传感器仓，和STM32F101C8主控间通过IIC连接，主控接到了…what？这板子的原理图异常的诡异，没有找到通信架构pdf里描述的，应该有的UART输入输出，有一个明显是主控的芯片却什么信息都没有，标号和介绍只写了“Sensor”（文件名），我下次需要把这个部件拆开看看。

- ServoMotor.pdf : 
好家伙，懒得给Layout了已经（大雾  
也是画的很糙，那个疑似主控的，标号为“ServoMotor”东西推断为STM32F101C8（参考源码），使用了TB6612FNG作为电机驱动器

- Diving.pdf ： 
浮潜仓控制板，我们没有这个组件所以不细说了。

- Control.pdf :  
从电池出来的电压经一个保险丝，接入三个LDO进行分配，分别为供电机的两个5.0V和供主控的3.3V。主板上有两个包含电机驱动电源和IO口的连接器（S1, S2）和一个未知的接口（PINSB2，引出了大量I/O），但是没有更多的信息，很可能这节机舱内还有另外一块电机控制板。
该组件内有DHT11湿度传感器和用于电池电压监测的分压电阻。
